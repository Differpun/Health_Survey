<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Health Survey</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">

  <form id="healthForm" class="bg-white p-6 rounded shadow-md space-y-4 w-96">
    <h2 class="text-xl font-bold">แบบสอบถามสุขภาพ</h2>

    <!-- อายุ -->
    <div>
      <label class="block font-semibold">อายุ (ปี)</label>
      <input type="number" id="age" class="w-full border p-2 rounded" placeholder="15 - 60">
      <span id="ageError" class="text-red-600 text-sm"></span>
    </div>

    <!-- เพศ -->
    <div>
      <label class="block font-semibold">เพศ</label>
      <div class="flex space-x-4">
        <label><input type="radio" name="gender" value="ชาย"> ชาย</label>
        <label><input type="radio" name="gender" value="หญิง"> หญิง</label>
      </div>
      <span id="genderError" class="text-red-600 text-sm"></span>
    </div>

    <!-- น้ำหนัก -->
    <div>
      <label class="block font-semibold">น้ำหนัก (กก.)</label>
      <input type="number" id="weight" class="w-full border p-2 rounded" placeholder="เช่น 60">
      <span id="weightError" class="text-red-600 text-sm"></span>
    </div>

    <!-- ส่วนสูง -->
    <div>
      <label class="block font-semibold">ส่วนสูง (ซม.)</label>
      <input type="number" id="height" class="w-full border p-2 rounded" placeholder="เช่น 170">
      <span id="heightError" class="text-red-600 text-sm"></span>
    </div>

    <!-- โรคประจำตัว -->
    <div>
      <label class="block font-semibold">
        <input type="checkbox" id="hasDisease"> มีโรคประจำตัว
      </label>
    </div>

    <!-- รายละเอียดโรค -->
    <div id="diseaseDetailDiv" class="hidden">
      <label class="block font-semibold">ระบุโรคประจำตัว</label>
      <textarea id="diseaseDetail" class="w-full border p-2 rounded"></textarea>
      <span id="diseaseError" class="text-red-600 text-sm"></span>
    </div>

    <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded">ส่งแบบสอบถาม</button>
  </form>

  <!-- Modal -->
  <div id="modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
    <div class="bg-white p-6 rounded shadow-md text-center w-80">
      <h2 class="text-xl font-bold mb-4">ผลการประเมิน</h2>
      <p id="modalMessage"></p>
      <button id="closeModal" class="bg-blue-600 text-white px-4 py-2 rounded mt-4">ปิด</button>
    </div>
  </div>

  <script>
    const healthForm = document.getElementById("healthForm");
    const age = document.getElementById("age");
    const weight = document.getElementById("weight");
    const height = document.getElementById("height");
    const hasDisease = document.getElementById("hasDisease");
    const diseaseDetailDiv = document.getElementById("diseaseDetailDiv");
    const diseaseDetail = document.getElementById("diseaseDetail");

    const ageError = document.getElementById("ageError");
    const genderError = document.getElementById("genderError");
    const weightError = document.getElementById("weightError");
    const heightError = document.getElementById("heightError");
    const diseaseError = document.getElementById("diseaseError");

    const modal = document.getElementById("modal");
    const modalMessage = document.getElementById("modalMessage");
    const closeModal = document.getElementById("closeModal");

    hasDisease.addEventListener("change", function() {
      diseaseDetailDiv.classList.toggle("hidden", !hasDisease.checked);
    });

    healthForm.addEventListener("submit", function(e) {
      e.preventDefault();
      let valid = true;

      ageError.textContent = "";
      genderError.textContent = "";
      weightError.textContent = "";
      heightError.textContent = "";
      diseaseError.textContent = "";

      const ageValue = parseInt(age.value);
      const weightValue = parseFloat(weight.value);
      const heightValue = parseFloat(height.value);

      // อายุ 15-60
      if (isNaN(ageValue) || ageValue < 15 || ageValue > 60) {
        ageError.textContent = "อายุต้องอยู่ระหว่าง 15–60 ปี";
        valid = false;
      }

      // เพศต้องเลือก
      const gender = document.querySelector('input[name="gender"]:checked');
      if (!gender) {
        genderError.textContent = "กรุณาเลือกเพศ";
        valid = false;
      }

      // น้ำหนักต้องเป็นค่าบวก
      if (isNaN(weightValue) || weightValue <= 0) {
        weightError.textContent = "น้ำหนักต้องเป็นค่าบวก";
        valid = false;
      }

      // ส่วนสูงต้องเป็นค่าบวก
      if (isNaN(heightValue) || heightValue <= 0) {
        heightError.textContent = "ส่วนสูงต้องเป็นค่าบวก";
        valid = false;
      }

      // ถ้าเลือกโรคประจำตัว ต้องกรอก
      if (hasDisease.checked && diseaseDetail.value.trim() === "") {
        diseaseError.textContent = "กรุณาระบุโรคประจำตัว";
        valid = false;
      }

      if (valid) {
        const bmi = weightValue / ((heightValue / 100) ** 2);
        let category = "";
        if (bmi < 18.5) category = "น้ำหนักน้อย";
        else if (bmi < 25) category = "ปกติ";
        else if (bmi < 30) category = "น้ำหนักเกิน";
        else category = "อ้วน";

        modalMessage.textContent = `BMI: ${bmi.toFixed(2)} (${category})`;
        modal.classList.remove("hidden");
      }
    });

    closeModal.addEventListener("click", () => modal.classList.add("hidden"));
    modal.addEventListener("click", e => { if (e.target === modal) modal.classList.add("hidden"); });
  </script>
</body>
</html>
